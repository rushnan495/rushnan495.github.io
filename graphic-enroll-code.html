<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Graphics & Web Design Course</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif;margin:0;padding:0}
body{
  min-height:100vh;
  background:linear-gradient(-45deg,#0f172a,#1e293b,#0ea5a4,#38bdf8);
  background-size:400% 400%;
  animation:gradientMove 10s ease infinite;
  color:#fff;
}
@keyframes gradientMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

nav{position:fixed;top:0;left:0;width:100%;background:rgba(15,23,42,0.9);
padding:14px 22px;display:flex;justify-content:space-between;align-items:center;z-index:10}
.logo{display:flex;align-items:center;gap:10px;color:#38bdf8;font-weight:700}

.container{max-width:1000px;margin:140px auto;padding:20px}
.course-card{
  background:rgba(15,23,42,0.85);padding:24px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.25)
}
.enroll-btn{
  background:#38bdf8;color:#072a29;border:none;padding:10px 18px;border-radius:8px;font-weight:700;cursor:pointer
}
.enroll-btn:hover{background:#0ea5a4}

/* Modal popup */
.modal-bg{
  position:fixed;inset:0;background:rgba(0,0,0,0.7);
  display:flex;align-items:center;justify-content:center;z-index:1000;
}
.modal{
  background:#0b1220;border-radius:14px;padding:24px;width:350px;color:#fff;
  box-shadow:0 10px 40px rgba(0,0,0,0.7);
  animation:pop 0.3s ease;
}
@keyframes pop{from{transform:scale(0.9);opacity:0}to{transform:scale(1);opacity:1}}

.modal h3{color:#38bdf8;margin-bottom:6px}
.desc{font-size:14px;color:#cfeff2;margin-bottom:14px}

.code-row{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.code-box{
  width:45px;height:55px;border:none;border-radius:8px;
  background:rgba(255,255,255,0.06);color:#fff;
  font-size:22px;font-weight:700;text-align:center;outline:none;
}
.code-box:focus{outline:2px solid #38bdf8}

.actions{display:flex;gap:8px;justify-content:center;margin-top:10px}
.btn{padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
.btn-primary{background:#38bdf8;color:#072a29;border:none}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:#fff}

.msg{text-align:center;font-size:14px;margin-top:10px}
.copy-section{text-align:center;margin-top:14px;font-size:14px}
.copy-btn{background:#38bdf8;color:#072a29;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-weight:600}
</style>
</head>
<body>

<nav>
  <div class="logo">
    <img src="logo.png" style="width:36px;height:36px;border-radius:50%;border:2px solid #38bdf8">
    EDU SPORTS IT
  </div>
</nav>

<div class="container">
  <div class="course-card">
    <h1 style="color:#38bdf8;">Graphics & Web Design Course</h1>
    <p>Complete A→Z course. Use your unique code to unlock your enrollment.</p>
    <button class="enroll-btn" id="openModalBtn">Enroll Now</button>
  </div>
</div>

<div id="modalRoot"></div>

<footer style="text-align:center;padding:40px;color:#94a3b8">
  © 2025 EDU SPORTS INFORMATION & TECHNOLOGY
</footer>

<script>
// Firebase setup
const firebaseConfig = {
  apiKey: "AIzaSyDR5yywOyYjCSnfTyLTcMUIz-hG80jZXU4",
  authDomain: "edu-sports-it.firebaseapp.com",
  databaseURL: "https://edu-sports-it-default-rtdb.firebaseio.com",
  projectId: "edu-sports-it"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const openBtn = document.getElementById('openModalBtn');
const modalRoot = document.getElementById('modalRoot');

// popup modal create
openBtn.onclick = async () => {
  const user = auth.currentUser;
  if (!user) {
    if (confirm("You must be logged in to unlock. Go to login page?")) {
      window.location.href = "login.html";
    }
    return;
  }

  const modal = document.createElement("div");
  modal.className = "modal-bg";
  modal.innerHTML = `
    <div class="modal">
      <h3>Enter your 6-digit Code</h3>
      <div class="desc">Enter the one-time code you purchased. Code can be used once only.</div>
      <div class="code-row">
        ${Array(6).fill().map((_,i)=>`<input maxlength="1" inputmode="numeric" class="code-box" id="code${i}">`).join("")}
      </div>
      <div class="actions">
        <button class="btn btn-primary" id="verifyBtn">Verify</button>
        <button class="btn btn-ghost" id="closeBtn">Cancel</button>
      </div>
      <div class="msg" id="msgBox"></div>
      <div class="copy-section">
        Don’t have code? Contact <b>Rushnan Khan</b><br>
        WhatsApp: <span id="waNum">01966090467</span>
        <button class="copy-btn" id="copyBtn">Copy</button>
      </div>
    </div>`;
  modalRoot.appendChild(modal);

  const boxes = [...modal.querySelectorAll('.code-box')];
  const msgBox = modal.querySelector('#msgBox');
  const copyBtn = modal.querySelector('#copyBtn');

  boxes.forEach((b,i)=>{
    b.addEventListener('input',e=>{
      e.target.value = e.target.value.replace(/[^0-9]/g,'');
      if(e.target.value && i<5) boxes[i+1].focus();
    });
    b.addEventListener('keydown',e=>{
      if(e.key==='Backspace' && !e.target.value && i>0) boxes[i-1].focus();
      if(e.key==='ArrowLeft' && i>0) boxes[i-1].focus();
      if(e.key==='ArrowRight' && i<5) boxes[i+1].focus();
    });
    b.addEventListener('paste',e=>e.preventDefault()); // disable paste
  });

  modal.querySelector('#closeBtn').onclick = ()=>modal.remove();
  copyBtn.onclick = ()=>{
    navigator.clipboard.writeText('01966090467');
    copyBtn.textContent='Copied!';
    setTimeout(()=>copyBtn.textContent='Copy',1500);
  };

  modal.querySelector('#verifyBtn').onclick = async ()=>{
    const code = boxes.map(b=>b.value).join('');
    if(code.length!==6){
      msgBox.style.color='#fca5a5';
      msgBox.textContent='Please enter 6 digits.';
      return;
    }

    msgBox.style.color='#ddd';
    msgBox.textContent='Verifying...';
    const ref = db.ref('codes/'+code);

    const snapshot = await ref.once('value');
    const val = snapshot.val();

    if(!val){
      msgBox.style.color='#fca5a5';
      msgBox.textContent='Invalid code.';
      return;
    }
    if(val.usedBy && val.usedBy!==auth.currentUser.uid){
      msgBox.style.color='#fca5a5';
      msgBox.textContent='This code already used.';
      return;
    }

    await ref.transaction(current=>{
      if(!current) return;
      if(current.usedBy) return;
      return {...current, usedBy: auth.currentUser.uid, usedAt: firebase.database.ServerValue.TIMESTAMP};
    });

    await db.ref('users/'+auth.currentUser.uid+'/enrolledCourses/graphics_web_design')
      .set({unlocked:true,code,unlockedAt:firebase.database.ServerValue.TIMESTAMP});

    msgBox.style.color='#4ade80';
    msgBox.textContent='✅ Code accepted! Course unlocked.';
    setTimeout(()=>modal.remove(),1600);
  };
};
</script>
</body>
</html>
