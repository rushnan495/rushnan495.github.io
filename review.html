<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Community Chat</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:linear-gradient(-45deg,#0f172a,#1e293b,#0ea5a4,#38bdf8);background-size:400% 400%;animation:gradientMove 10s ease infinite;color:#fff;min-height:100vh;overflow-x:hidden;padding-bottom:120px;}
@keyframes gradientMove{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
nav{position:fixed;top:0;left:0;width:100%;background:rgba(15,23,42,0.95);display:flex;justify-content:space-between;align-items:center;padding:14px 20px;z-index:1000;backdrop-filter:blur(6px);}
.logo{display:flex;align-items:center;font-weight:700;font-size:22px;color:#38bdf8;gap:10px;}
.logo img{width:38px;height:38px;border-radius:50%;object-fit:cover;border:2px solid #38bdf8;}
.nav-links{display:flex;gap:20px;}
.nav-links a{color:#fff;text-decoration:none;font-weight:500;padding:8px 12px;border-radius:6px;transition:0.3s;}
.nav-links a:hover{background:#38bdf8;color:#0f172a;}
.menu-btn{display:none;color:#fff;font-size:30px;background:none;border:none;cursor:pointer;}
@media(max-width:900px){.menu-btn{display:block;}.nav-links{display:flex;flex-direction:column;position:fixed;top:60px;right:-220px;background:rgba(15,23,42,0.95);width:200px;padding:15px;border-radius:0 0 0 8px;text-align:right;transition:right 0.3s ease;z-index:999;}.nav-links.active{right:0;}.nav-links a{margin-bottom:12px;}}
h1{text-align:center;color:#38bdf8;margin:80px 0 20px 0;font-size:2rem;cursor:pointer;}

/* Chat container fixed bottom */
.chat-wrapper{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:400px;max-width:95%;background:rgba(0,0,0,0.1);border-radius:12px;display:flex;flex-direction:column;box-shadow:0 0 20px rgba(0,0,0,0.3);overflow:hidden;}
.chat-messages{flex:1;max-height:300px;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px;background:rgba(255,255,255,0.05);}
.message-card{display:flex;gap:10px;align-items:flex-start;position:relative;flex-wrap:wrap;}
.message-card.left{flex-direction:row;}
.message-card.right{flex-direction:row-reverse;}
.message-card img{width:45px;height:45px;border-radius:50%;object-fit:cover;}
.meta{display:flex;flex-direction:column;max-width:75%;}
.meta h3{margin:0;color:#38bdf8;font-size:14px;display:flex;align-items:center;gap:5px;}
.meta small{color:#cbd5e1;font-size:11px;}
.meta p{margin:4px 0 0 0;font-size:14px;color:#e6eef5;white-space:pre-wrap;}
.delete-btn{position:absolute;top:4px;right:4px;background:red;border:none;color:#fff;padding:2px 6px;border-radius:4px;font-size:11px;cursor:pointer;transition:0.2s;}
.delete-btn:hover{background:darkred;}

/* Send area */
.send-area{
  display:flex;gap:8px;padding:12px;background:rgba(255,255,255,0.1);border-top:1px solid #38bdf8;border-radius:0 0 12px 12px;
}
.send-area textarea{
  flex:1;padding:12px;border-radius:8px;border:none;background:rgba(255,255,255,0.1);color:#fff;font-size:16px;resize:none;outline:none;
}
.send-area button{
  background:#38bdf8;color:#0f172a;border:none;padding:12px 14px;border-radius:50%;font-weight:bold;cursor:pointer;transition:0.3s;
}
.send-area button:hover{background:#0ea5a4;transform:scale(1.05);}
.send-area input[type=file]{display:none;}
.file-icon{cursor:pointer;font-size:20px;color:#38bdf8;display:flex;align-items:center;justify-content:center;}

/* Admin Panel */
.admin-panel{position:fixed;top:60px;right:20px;background:rgba(0,0,0,0.2);padding:15px;border-radius:10px;display:none;flex-direction:column;gap:10px;z-index:999;}
.admin-panel.open{display:flex;}
.admin-panel input{width:100%;margin:8px 0;padding:12px;border:none;border-radius:8px;background:rgba(255,255,255,0.1);color:white;font-size:16px;outline:none;}
.admin-panel button{width:100%;margin:8px 0;padding:12px;border:none;border-radius:8px;background:#38bdf8;color:#0f172a;font-weight:bold;cursor:pointer;transition:0.3s;}
.admin-panel button:hover{background:#0ea5a4;transform:scale(1.03);}

/* Verified badge */
.admin-badge{width:16px;height:16px;background:#1877F2;border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0;cursor:pointer;}
.admin-badge::after{content:'\2713';color:white;font-size:10px;font-weight:bold;}
.admin-badge::before{content:"";position:absolute;bottom:125%;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:2px 6px;font-size:10px;border-radius:4px;white-space:nowrap;opacity:0;transition:0.3s;z-index:1000;}
.admin-badge:hover::before{content:"Verified Account";opacity:1;}
.admin-badge span{position:absolute;width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid #333;bottom:-5px;left:50%;transform:translateX(-50%);display:none;}
.admin-badge:hover span{ display:block; }
</style>
</head>
<body>
<nav>
<div class="logo"><img src="edu-sports-it.png" alt="Logo"><span>EDU SPORTS IT</span></div>
<button class="menu-btn" id="menuBtn">&#9776;</button>
<div class="nav-links" id="navLinks">
<a href='/'>Home</a>
<a href='/courses'>Courses</a>
<a href='/about'>About</a>
<a href='/chat'>World Chat</a>
<a href='/help'>Help Center</a>
<a href='/review'>Reviews</a>
<a href='/login'>Login</a>
<a href='/signup'>Sign-Up</a>
<a href='/profile'>Profile</a>
</div>
</nav>

<h1 id="chatHeading">Community Chat & News</h1>

<div class="chat-wrapper">
<div class="chat-messages" id="chatMessages"></div>
<div class="send-area">
<label for="chatMedia" class="file-icon">&#128247;</label>
<input type="file" id="chatMedia" accept="image/*,video/*">
<textarea id="chatInput" placeholder="Type a message..."></textarea>
<button onclick="sendMessage()">&#10148;</button>
</div>
</div>

<div class="admin-panel" id="adminPanel">
<div class="login-panel" id="adminLogin">
<h3>Admin Login</h3>
<input type="email" id="adminEmail" placeholder="Admin Email">
<input type="password" id="adminPass" placeholder="Password">
<button onclick="adminLogin()">Login</button>
</div>
<h3>Admin Controls</h3>
<button id="btnDeleteAll" style="display:none" onclick="deleteAll()">Delete All Messages</button>
<button id="btnToggleChat" style="display:none" onclick="toggleChat()">Toggle Chat On/Off</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyDR5yywOyYjCSnfTyLTcMUIz-hG80jZXU4",authDomain:"edu-sports-it.firebaseapp.com",databaseURL:"https://edu-sports-it-default-rtdb.firebaseio.com/",projectId:"edu-sports-it",storageBucket:"edu-sports-it.appspot.com",messagingSenderId:"1234567890",appId:"1:1234567890:web:abcdefg"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const auth=firebase.auth();

const verifiedUsers={"rushnankhan02@gmail.com":{name:"Rushnan Khan — ADMIN",photo:"rushnan.jpg"},"contact@mubarrat.com":{name:"Mubarrat — VERIFIED",photo:"mubarrat.jpg"},"msaadman56@proton.me":{name:"Saadman — VERIFIED",photo:"saadu.jpg"}};
const adminEmails=["rushnankhan02@gmail.com"];
let isAdmin=false;
let chatEnabled=true;

document.getElementById("menuBtn").addEventListener('click',()=>document.getElementById("navLinks").classList.toggle("active"));
document.getElementById("chatHeading").addEventListener('click',()=>document.getElementById("adminPanel").classList.toggle("open"));

auth.onAuthStateChanged(user=>{});

function adminLogin(){
  const email=document.getElementById("adminEmail").value;
  const pass=document.getElementById("adminPass").value;
  if(!adminEmails.includes(email)){alert("You are not allowed to login as admin!");return;}
  auth.signInWithEmailAndPassword(email,pass).then(()=>{
    isAdmin=true;
    alert("Admin logged in!");
    document.getElementById("adminLogin").style.display="none";
    document.getElementById("btnDeleteAll").style.display="block";
    document.getElementById("btnToggleChat").style.display="block";
    loadMessages();
  }).catch(err=>alert("Login failed: "+err.message));
}

function sendMessage(){
  const user=auth.currentUser;
  if(!user){alert("Please login first!");return;}
  const text=document.getElementById("chatInput").value.trim();
  const media=document.getElementById("chatMedia").files[0];
  if(!text && !media){alert("Write something or select file!");return;}
  const userEmail=user.email;
  const isVerified=verifiedUsers.hasOwnProperty(userEmail);
  const msgData={
    name:isVerified?verifiedUsers[userEmail].name:(user.displayName||"Anonymous"),
    photo:isVerified?verifiedUsers[userEmail].photo||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png":(user.photoURL||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png"),
    text:text,
    time:new Date().toLocaleString(),
    uid:user.uid,
    verified:isVerified
  };
  if(media){
    const reader=new FileReader();
    reader.onload=function(e){msgData.file=e.target.result;db.ref("chat").push(msgData);};
    reader.readAsDataURL(media);
  }else{db.ref("chat").push(msgData);}
  document.getElementById("chatInput").value="";
  document.getElementById("chatMedia").value="";
}

function loadMessages(){
  const container=document.getElementById("chatMessages");
  db.ref("chat").on("value",snapshot=>{
    container.innerHTML="";
    snapshot.forEach(child=>{
      const data=child.val();
      const id=child.key;
      const div=document.createElement("div");
      div.classList.add("message-card");
      div.classList.add(data.uid===auth.currentUser?.uid?"right":"left");
      div.innerHTML=`
        <img src="${data.photo || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}" alt="user">
        <div class="meta">
          <h3>${data.name}${data.verified?'<span class="admin-badge"><span></span></span>':""}</h3>
          <small>${data.time}</small>
          <p>${data.text||""}</p>
          ${data.file?`<a href="${data.file}" target="_blank" style="color:#38bdf8;">View File</a>`:""}
          ${(isAdmin||data.uid===auth.currentUser?.uid)?`<button class="delete-btn" onclick="deleteMessage('${id}')">X</button>`:""}
        </div>
      `;
      container.appendChild(div);
      container.scrollTop=container.scrollHeight;
    });
  });
}

function deleteMessage(id){if(confirm("Delete this message?")) db.ref("chat/"+id).remove();}
function deleteAll(){if(confirm("Delete ALL messages?")) db.ref("chat").remove();}
function toggleChat(){chatEnabled=!chatEnabled;document.querySelector(".send-area").style.display=chatEnabled?"flex":"none";}

loadMessages();

function loadMessages(){
  const container=document.getElementById("chatMessages");
  db.ref("chat").on("value",snapshot=>{
    container.innerHTML="";
    snapshot.forEach(child=>{
      const data=child.val();
      const id=child.key;

      const div=document.createElement("div");
      div.classList.add("message-card");
      div.classList.add(data.uid===auth.currentUser?.uid?"right":"left");

      div.innerHTML=`
        <img src="${data.photo || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}" alt="user">
        <div class="meta">
          <h3>${data.name}${data.verified?'<span class="admin-badge"><span></span></span>':""}</h3>
          <small>${data.time}</small>
          <p>${data.text||""}</p>
          ${data.file && data.file.startsWith('data:image')?`<img src="${data.file}" style="max-width:150px;max-height:150px;border-radius:8px;cursor:pointer;" onclick="openImage('${data.file}')">`:""}
          ${(isAdmin||data.uid===auth.currentUser?.uid)?`<button class="delete-btn" onclick="deleteMessage('${id}')">X</button>`:""}
        </div>
      `;
      container.appendChild(div);
      container.scrollTop=container.scrollHeight;
    });
  });
}

// Image Modal
document.body.insertAdjacentHTML('beforeend', `
<div id="imgModal" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000;">
  <img id="modalImg" style="max-width:90%;max-height:90%;border-radius:10px;cursor:pointer;">
</div>
`);
function openImage(src){
  if(!src) return;
  const modal=document.getElementById("imgModal");
  const modalImg=document.getElementById("modalImg");
  modalImg.src=src;
  modal.style.display="flex";
  modalImg.onclick = ()=>{ modal.style.display="none"; }
  modal.onclick = ()=>{ modal.style.display="none"; }
}

</script>
</body>
</html>
